import{_ as L,r as v,o as P,g as T,a as R,c as b,b as t,h as $,t as n,i as m,n as h,d,v as u,F,j as O,w as J,S as i,f}from"./index-DK9EypC2.js";const G={class:"contenido-principal"},H={class:"container mt-4"},X={class:"encabezado-dashboard d-flex flex-wrap justify-content-between align-items-center p-3 mb-4"},Y={class:"reloj text-end"},K={class:"m-0"},Q={class:"m-0"},W={class:"card tarjeta-kpi p-4 mb-4"},Z={class:"mb-3 d-flex align-items-center"},ee={class:"row align-items-center"},te={class:"col-md-4 mb-2"},oe={class:"btn-group",role:"group"},le={class:"col-md-8 mb-2 d-flex align-items-center justify-content-end"},ae={class:"input-group me-2"},se={class:"modal fade",id:"modalAgregarCliente",tabindex:"-1","aria-labelledby":"modalAgregarClienteLabel","aria-hidden":"true"},ne={class:"modal-dialog"},ie={class:"modal-content"},re={class:"modal-body"},de={class:"row"},ue={class:"col-md-6 mb-3"},ce={class:"col-md-6 mb-3"},me={class:"col-md-6 mb-3"},ve={class:"col-md-6 mb-3"},pe={class:"col-md-12 mb-3"},be={class:"card tarjeta-tabla p-4"},fe={class:"tabla-scroll"},ge={class:"table table-hover tabla-clientes mb-0"},ye={class:"td-nombre"},Ce={class:"td-edad"},we={class:"td-telefono"},_e={class:"td-suscripcion"},xe={class:"td-dias"},he={class:"td-acciones"},ke={class:"acciones-btns d-flex gap-1 justify-content-center"},je=["onClick"],Me=["onClick"],Ne={key:0},Ee={key:0,class:"card tarjeta-tabla p-4 mb-4"},Ae={class:"row"},Pe={class:"col-md-4 mb-2"},Te={class:"col-md-4 mb-2"},$e={class:"col-md-4 mb-2"},qe={class:"col-md-4 mb-2"},Ve={class:"col-md-4 mb-2"},Be={class:"text-end mt-3"},De={key:1,class:"row"},Ie={class:"col-md-4 mb-2"},Ue={class:"col-md-4 mb-2"},Se={class:"col-md-4 mb-2"},ze={class:"col-md-4 mb-2"},Le={class:"col-md-4 mb-2"},Re={class:"col-md-4 mb-2"},Fe={class:"col-md-4 mb-2"},Oe={__name:"Clientes",setup(Je){const a=v(null),y=v(!1);function q(l){let e="",o="",c="";if(l.nombre){const r=l.nombre.trim().split(" ");r.length===1?e=r[0]:r.length===2?(e=r[0],o=r[1]):r.length>=3&&(e=r[0],o=r[1],c=r.slice(2).join(" "))}a.value={...l,nombre:e,apellidoPaterno:o,apellidoMaterno:c},y.value=!0}async function V(){if(!a.value.nombre||!a.value.apellidoPaterno||!a.value.apellidoMaterno||!a.value.edad||!a.value.telefono){await i.fire({icon:"warning",title:"Campos incompletos",text:"Por favor completa todos los campos."});return}try{const l={nombre:a.value.nombre,apellido_paterno:a.value.apellidoPaterno,apellido_materno:a.value.apellidoMaterno,edad:a.value.edad,telefono:a.value.telefono,activo:!0},e=await fetch(`http://localhost:8080/backend/public/api/gym/clientes/${a.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),o=await e.json();if(e.ok){const c=g.value.findIndex(r=>r.id===a.value.id);c!==-1&&(g.value[c]={...g.value[c],nombre:`${l.nombre} ${l.apellido_paterno} ${l.apellido_materno}`.trim(),edad:l.edad,telefono:l.telefono}),await i.fire({icon:"success",title:"Cliente actualizado",text:o.mensaje||"",showConfirmButton:!1,timer:1200})}else{await i.fire({icon:"error",title:"Error",text:o.error||"No se pudo actualizar el cliente."});return}}catch{await i.fire({icon:"error",title:"Error de conexión",text:"No se pudo conectar al servidor. Intenta más tarde."});return}y.value=!1,a.value=null}function B(){a.value=null}function D(){const l=document.getElementById("modalAgregarCliente");l&&new window.bootstrap.Modal(l).show()}async function j(){try{await fetch("http://localhost:8080/backend/public/api/gym/actualizar-dias-restantes",{method:"GET"});const l=await fetch("http://localhost:8080/backend/public/api/gym/clientes/paquetes");if(!l.ok)throw new Error("No se pudo cargar la lista de clientes");const e=await l.json();g.value=e.map(o=>({id:o.id_cliente,nombre:o.nombre_completo,edad:o.edad,telefono:o.telefono||"",paquete:o.paquete||"No especificado",diasRestantes:o.dias_restantes!==null&&o.dias_restantes!==void 0?o.dias_restantes:"N/A",activo:o.dias_restantes<=0?!1:!!o.activo}))}catch(l){i.fire("Error",l.message||"No se pudo cargar la lista de clientes","error")}}async function I(){if(!s.value.nombre||!s.value.apellidoPaterno||!s.value.apellidoMaterno||!s.value.edad||!s.value.telefono){i.fire({icon:"warning",title:"Campos incompletos",text:"Por favor completa todos los campos."});return}try{const l=await fetch("http://localhost:8080/backend/public/api/gym/clientes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nombre:s.value.nombre,apellido_paterno:s.value.apellidoPaterno,apellido_materno:s.value.apellidoMaterno,edad:s.value.edad,telefono:s.value.telefono})}),e=await l.json();if(l.ok){i.fire({icon:"success",title:"Cliente agregado",text:e.mensaje||"Cliente agregado correctamente",showConfirmButton:!1,timer:1200}),s.value={nombre:"",apellidoPaterno:"",apellidoMaterno:"",edad:"",telefono:""};const o=document.getElementById("modalAgregarCliente");o&&window.bootstrap.Modal.getInstance(o).hide(),await j()}else i.fire({icon:"error",title:"Error",text:e.error||"No se pudo agregar el cliente."})}catch{i.fire({icon:"error",title:"Error de conexión",text:"No se pudo conectar al servidor. Intenta más tarde."})}}const C=v(""),p=v("activos"),s=v({nombre:"",apellidoPaterno:"",apellidoMaterno:"",edad:"",telefono:""}),g=v([]);P(async()=>{x(),_=setInterval(x,1e3),await j()});const M=T(()=>{let l=[...g.value];if(p.value==="activos"?l=l.filter(e=>e.activo):p.value==="inactivos"&&(l=l.filter(e=>!e.activo)),C.value.trim()){const e=C.value.toLowerCase();l=l.filter(o=>o.nombre.toLowerCase().includes(e)||o.telefono.includes(e))}return l}),k=l=>p.value=l,U=()=>{};async function S(l){const e=g.value.find(w=>w.id===l);if(!e)return;if(!e.activo&&e.diasRestantes<=0){i.fire({icon:"info",title:"No se puede reactivar",text:"El cliente no tiene un paquete activo, por lo que no puede reactivarse a menos que renueve o adquiera uno."});return}e.activo;const o=e.activo?"Sí, desactivar":"Sí, activar",c=e.activo?"¿Seguro que deseas desactivar este cliente?":"¿Seguro que deseas activar este cliente?",r=e.activo?"warning":"question";if((await i.fire({title:c,icon:r,showCancelButton:!0,confirmButtonText:o,cancelButtonText:"Cancelar",reverseButtons:!0})).isConfirmed)try{const w=await fetch(`http://localhost:8080/backend/public/api/gym/clientes/estado/${l}`,{method:"PUT",headers:{"Content-Type":"application/json"}}),A=await w.json();w.ok?(e.activo=!e.activo,i.fire({icon:"success",title:A.mensaje||"Estado actualizado",showConfirmButton:!1,timer:1200}),a.value&&a.value.id===l&&(a.value=null,y.value=!1)):i.fire({icon:"error",title:"Error",text:A.error||"No se pudo actualizar el estado."})}catch{i.fire({icon:"error",title:"Error de conexión",text:"No se pudo conectar al servidor. Intenta más tarde."})}}const z=T(()=>{switch(p.value){case"activos":return"Clientes Activos";case"inactivos":return"Clientes Inactivos";case"todos":return"Todos los Clientes";default:return"Clientes"}}),N=v(""),E=v("");let _=null;function x(){const l=["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],e=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],o=new Date;N.value=`${l[o.getDay()]}, ${o.getDate()} de ${e[o.getMonth()]} de ${o.getFullYear()}`,E.value=o.toLocaleTimeString("es-MX",{hour12:!1})}return P(()=>{x(),_=setInterval(x,1e3)}),R(()=>{_&&clearInterval(_)}),(l,e)=>(f(),b("div",G,[t("div",H,[t("div",X,[e[16]||(e[16]=t("div",{class:"saludo"},[t("h4",{class:"m-0"},"Clientes")],-1)),t("div",Y,[t("p",K,n(N.value),1),t("p",Q,n(E.value),1)])]),t("div",W,[t("h5",Z,[e[17]||(e[17]=t("i",{class:"material-icons me-2"},"group",-1)),m(" "+n(z.value),1)]),t("div",ee,[t("div",te,[t("div",oe,[t("button",{class:h(["btn",p.value==="activos"?"btn-primary":"btn-outline-primary"]),onClick:e[0]||(e[0]=o=>k("activos"))},"Activos",2),t("button",{class:h(["btn",p.value==="inactivos"?"btn-secondary":"btn-outline-secondary"]),onClick:e[1]||(e[1]=o=>k("inactivos"))},"Inactivos",2),t("button",{class:h(["btn",p.value==="todos"?"btn-info":"btn-outline-info"]),onClick:e[2]||(e[2]=o=>k("todos"))},"Todos",2)])]),t("div",le,[t("div",ae,[d(t("input",{type:"text",class:"form-control",placeholder:"Buscar cliente...","onUpdate:modelValue":e[3]||(e[3]=o=>C.value=o),onInput:U},null,544),[[u,C.value]]),t("button",{class:"btn btn-outline-secondary",onClick:e[4]||(e[4]=o=>{C.value=""})},e[18]||(e[18]=[t("i",{class:"material-icons"},"clear",-1)]))]),t("button",{class:"btn btn-success",onClick:D},e[19]||(e[19]=[t("i",{class:"material-icons me-1"},"person_add",-1)]))])])]),t("div",se,[t("div",ne,[t("div",ie,[e[21]||(e[21]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"modalAgregarClienteLabel"},"Agregar nuevo cliente"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Cerrar"})],-1)),t("div",re,[t("div",de,[t("div",ue,[d(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>s.value.nombre=o),type:"text",class:"form-control",placeholder:"Nombre(s)"},null,512),[[u,s.value.nombre]])]),t("div",ce,[d(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>s.value.apellidoPaterno=o),type:"text",class:"form-control",placeholder:"Apellido paterno"},null,512),[[u,s.value.apellidoPaterno]])]),t("div",me,[d(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>s.value.apellidoMaterno=o),type:"text",class:"form-control",placeholder:"Apellido materno"},null,512),[[u,s.value.apellidoMaterno]])]),t("div",ve,[d(t("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>s.value.edad=o),type:"number",class:"form-control",placeholder:"Edad",min:"0"},null,512),[[u,s.value.edad]])]),t("div",pe,[d(t("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>s.value.telefono=o),type:"tel",class:"form-control",placeholder:"Teléfono"},null,512),[[u,s.value.telefono]])])])]),t("div",{class:"modal-footer"},[e[20]||(e[20]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancelar",-1)),t("button",{type:"button",class:"btn btn-success",onClick:I},"Agregar Cliente")])])])]),t("div",be,[e[26]||(e[26]=t("h5",{class:"mb-3 d-flex align-items-center"},[t("i",{class:"material-icons me-2"},"table_view"),m(" Listado de clientes ")],-1)),t("div",fe,[t("table",ge,[e[25]||(e[25]=t("thead",null,[t("tr",null,[t("th",null,"Nombre completo"),t("th",null,"Edad"),t("th",null,"Teléfono"),t("th",null,"Paquete"),t("th",null,"Días restantes"),t("th",null,"Acciones")])],-1)),t("tbody",null,[(f(!0),b(F,null,O(M.value,o=>(f(),b("tr",{key:o.id},[t("td",ye,n(o.nombre),1),t("td",Ce,n(o.edad),1),t("td",we,n(o.telefono),1),t("td",_e,n(o.paquete),1),t("td",xe,[t("span",{class:h({"dias-verde":o.diasRestantes>10,"dias-amarillo":o.diasRestantes>5&&o.diasRestantes<=10,"dias-rojo":o.diasRestantes<=5,"dias-centro":!0})},n(o.diasRestantes),3)]),t("td",he,[t("div",ke,[t("button",{class:"btn btn-sm btn-outline-warning",title:"Editar",onClick:c=>q(o)},e[22]||(e[22]=[t("i",{class:"material-icons"},"edit",-1)]),8,je),t("button",{class:"btn btn-sm btn-outline-danger",title:"Desactivar cliente",onClick:c=>S(o.id)},e[23]||(e[23]=[t("i",{class:"material-icons"},"delete",-1)]),8,Me)])])]))),128)),M.value.length===0?(f(),b("tr",Ne,e[24]||(e[24]=[t("td",{colspan:"8",class:"text-center text-muted"},"No hay clientes encontrados.",-1)]))):$("",!0)])])])]),a.value?(f(),b("div",Ee,[t("div",{class:"d-flex justify-content-between align-items-center mb-2"},[e[28]||(e[28]=t("h5",{class:"mb-0"},"Detalle de cliente",-1)),t("button",{class:"btn btn-sm btn-outline-secondary",onClick:B,title:"Cerrar"},e[27]||(e[27]=[t("i",{class:"material-icons"},"close",-1)]))]),y.value?(f(),b("form",{key:0,onSubmit:J(V,["prevent"])},[t("div",Ae,[t("div",Pe,[e[29]||(e[29]=t("label",{class:"form-label"},[t("b",null,"Nombre(s):")],-1)),d(t("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>a.value.nombre=o),type:"text",class:"form-control"},null,512),[[u,a.value.nombre]])]),t("div",Te,[e[30]||(e[30]=t("label",{class:"form-label"},[t("b",null,"Apellido paterno:")],-1)),d(t("input",{"onUpdate:modelValue":e[11]||(e[11]=o=>a.value.apellidoPaterno=o),type:"text",class:"form-control"},null,512),[[u,a.value.apellidoPaterno]])]),t("div",$e,[e[31]||(e[31]=t("label",{class:"form-label"},[t("b",null,"Apellido materno:")],-1)),d(t("input",{"onUpdate:modelValue":e[12]||(e[12]=o=>a.value.apellidoMaterno=o),type:"text",class:"form-control"},null,512),[[u,a.value.apellidoMaterno]])]),t("div",qe,[e[32]||(e[32]=t("label",{class:"form-label"},[t("b",null,"Edad:")],-1)),d(t("input",{"onUpdate:modelValue":e[13]||(e[13]=o=>a.value.edad=o),type:"number",class:"form-control",min:"0"},null,512),[[u,a.value.edad]])]),t("div",Ve,[e[33]||(e[33]=t("label",{class:"form-label"},[t("b",null,"Teléfono:")],-1)),d(t("input",{"onUpdate:modelValue":e[14]||(e[14]=o=>a.value.telefono=o),type:"tel",class:"form-control"},null,512),[[u,a.value.telefono]])])]),t("div",Be,[e[34]||(e[34]=t("button",{type:"submit",class:"btn btn-success me-2"},"Guardar cambios",-1)),t("button",{type:"button",class:"btn btn-secondary",onClick:e[15]||(e[15]=o=>y.value=!1)},"Cancelar")])],32)):(f(),b("div",De,[t("div",Ie,[e[35]||(e[35]=t("b",null,"Nombre(s):",-1)),m(" "+n(a.value.nombre),1)]),t("div",Ue,[e[36]||(e[36]=t("b",null,"Apellido paterno:",-1)),m(" "+n(a.value.apellidoPaterno),1)]),t("div",Se,[e[37]||(e[37]=t("b",null,"Apellido materno:",-1)),m(" "+n(a.value.apellidoMaterno),1)]),t("div",ze,[e[38]||(e[38]=t("b",null,"Edad:",-1)),m(" "+n(a.value.edad),1)]),t("div",Le,[e[39]||(e[39]=t("b",null,"Teléfono:",-1)),m(" "+n(a.value.telefono),1)]),t("div",Re,[e[40]||(e[40]=t("b",null,"Paquete:",-1)),m(" "+n(a.value.paquete||"No especificado"),1)]),t("div",Fe,[e[41]||(e[41]=t("b",null,"Días restantes:",-1)),m(" "+n(a.value.diasRestantes!==void 0?a.value.diasRestantes:"N/A"),1)])]))])):$("",!0)])]))}},Xe=L(Oe,[["__scopeId","data-v-53b2df81"]]);export{Xe as default};
