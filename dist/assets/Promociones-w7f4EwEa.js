import{_ as z,r as d,g as N,o as L,a as F,c as m,b as e,h as S,t as r,i as y,n as P,d as a,v as k,q as v,F as O,j as J,w as G,S as n,f as p}from"./index-DK9EypC2.js";const H={class:"contenido-principal"},X={class:"container mt-4"},Y={class:"encabezado-dashboard d-flex flex-wrap justify-content-between align-items-center p-3 mb-4"},K={class:"reloj text-end"},Q={class:"m-0"},R={class:"m-0"},W={class:"card tarjeta-kpi p-4 mb-4"},Z={class:"mb-3 d-flex align-items-center"},oo={class:"row align-items-center"},eo={class:"col-md-4 mb-2"},to={class:"btn-group",role:"group"},so={class:"col-md-8 mb-2 d-flex align-items-center justify-content-end"},lo={class:"input-group me-2"},io={class:"modal fade",id:"modalAgregarCliente",tabindex:"-1","aria-labelledby":"modalAgregarClienteLabel","aria-hidden":"true"},ao={class:"modal-dialog"},no={class:"modal-content"},ro={class:"modal-body"},co={class:"row"},uo={class:"col-md-12 mb-3"},mo={class:"col-md-6 mb-3"},po={class:"col-md-6 mb-3"},vo={class:"form-check"},bo={class:"form-check"},fo={class:"form-check"},go={class:"card tarjeta-tabla p-4"},yo={class:"tabla-scroll"},ko={class:"table table-hover tabla-clientes mb-0"},ho={class:"td-acciones"},wo={class:"acciones-btns d-flex gap-1 justify-content-center"},Co=["onClick"],xo=["onClick"],Po={key:0},To={key:0,class:"card tarjeta-tabla p-4 mb-4"},jo={class:"row"},qo={class:"col-md-4 mb-2"},Eo={class:"col-md-4 mb-2"},No={class:"col-md-4 mb-2"},So={class:"form-check"},Do={class:"form-check"},_o={class:"form-check"},Vo={class:"text-end mt-3"},Bo={key:1,class:"row"},Uo={class:"col-md-4 mb-2"},Mo={class:"col-md-4 mb-2"},$o={class:"col-md-4 mb-2"},Ao={__name:"Promociones",setup(Io){const l=d(null),b=d(!1);function D(s){let o=[];(s.producto||s.tipo&&s.tipo.includes("producto"))&&o.push("producto"),(s.servicio||s.tipo&&s.tipo.includes("servicio"))&&o.push("servicio"),(s.paquete||s.tipo&&s.tipo.includes("paquete"))&&o.push("paquete"),l.value={...s,tipos:o},b.value=!0}async function _(){if(!l.value.nombre||!l.value.descuento||!l.value.tipos||l.value.tipos.length===0){await n.fire({icon:"warning",title:"Campos incompletos",text:"Por favor completa todos los campos."});return}const s={nombre:l.value.nombre,descuento:l.value.descuento,producto:l.value.tipos.includes("producto"),servicio:l.value.tipos.includes("servicio"),paquete:l.value.tipos.includes("paquete")};try{const o=await fetch(`http://localhost:8080/backend/public/api/gym/promociones/${l.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),t=await o.json();if(!o.ok)throw new Error(t.error||"No se pudo actualizar la promoción");await n.fire({icon:"success",title:"Promoción actualizada",showConfirmButton:!1,timer:1200}),b.value=!1,l.value=null,await h()}catch(o){n.fire({icon:"error",title:"Error",text:o.message||"No se pudo actualizar la promoción."})}}function V(){l.value=null}function B(){const s=document.getElementById("modalAgregarCliente");s&&new window.bootstrap.Modal(s).show()}async function U(){if(!i.value.nombre||!i.value.descuento||!i.value.tipos||i.value.tipos.length===0){n.fire({icon:"warning",title:"Campos incompletos",text:"Por favor completa todos los campos."});return}const s={nombre:i.value.nombre,descuento:i.value.descuento,producto:i.value.tipos.includes("producto"),servicio:i.value.tipos.includes("servicio"),paquete:i.value.tipos.includes("paquete")};try{const o=await fetch("http://localhost:8080/backend/public/api/gym/promociones",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),t=await o.json();if(!o.ok)throw new Error(t.error||"No se pudo registrar la promoción");n.fire({icon:"success",title:"Promoción agregada",showConfirmButton:!1,timer:1200}),i.value={nombre:"",descuento:"",tipos:[]};const u=document.getElementById("modalAgregarCliente");u&&window.bootstrap.Modal.getInstance(u).hide(),await h()}catch(o){n.fire({icon:"error",title:"Error",text:o.message||"No se pudo registrar la promoción."})}}const f=d(""),c=d("activos"),i=d({nombre:"",descuento:"",tipos:[]}),g=d([]);async function h(){try{await fetch("http://localhost:8080/backend/public/api/gym/actualizar-dias-restantes",{method:"GET"});const s=await fetch("http://localhost:8080/backend/public/api/gym/promociones");if(!s.ok)throw new Error("No se pudo obtener la lista de promociones");const o=await s.json();g.value=o.map(t=>({id:t.id,nombre:t.nombre,descuento:t.descuento,tipo:t.tipo,activo:t.activo!==void 0?!!t.activo:!0}))}catch{n.fire({icon:"error",title:"Error",text:"No se pudo cargar la lista de promociones."})}}const T=N(()=>{let s=[...g.value];if(c.value==="activos"?s=s.filter(o=>o.activo===!0):c.value==="inactivos"&&(s=s.filter(o=>o.activo===!1)),f.value.trim()){const o=f.value.toLowerCase();s=s.filter(t=>t.nombre.toLowerCase().includes(o))}return s}),w=s=>c.value=s,M=()=>{};function $(s){n.fire({title:"¿Seguro que deseas desactivar esta promoción?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, desactivar",cancelButtonText:"Cancelar",reverseButtons:!0}).then(async o=>{if(o.isConfirmed)try{const t=await fetch(`http://localhost:8080/backend/public/api/gym/promociones/estado/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"}}),u=await t.json();if(t.ok){const x=g.value.findIndex(I=>I.id===s);x!==-1&&(g.value[x].activo=!g.value[x].activo),l.value&&l.value.id===s&&(l.value=null,b.value=!1),n.fire({icon:"success",title:u.mensaje||"Promoción actualizada",showConfirmButton:!1,timer:1200})}else n.fire({icon:"error",title:"Error",text:u.error||"No se pudo cambiar el estado de la promoción"})}catch{n.fire({icon:"error",title:"Error de red",text:"No se pudo conectar al servidor."})}})}const A=N(()=>{switch(c.value){case"activos":return"Promociones Activas";case"inactivos":return"Promociones Inactivas";case"todos":return"Todas las Promociones";default:return"Promociones"}}),j=d(""),q=d("");let C=null;function E(){const s=["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],o=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],t=new Date;j.value=`${s[t.getDay()]}, ${t.getDate()} de ${o[t.getMonth()]} de ${t.getFullYear()}`,q.value=t.toLocaleTimeString("es-MX",{hour12:!1})}return L(()=>{E(),C=setInterval(E,1e3),h()}),F(()=>{C&&clearInterval(C)}),(s,o)=>(p(),m("div",H,[e("div",X,[e("div",Y,[o[16]||(o[16]=e("div",{class:"saludo"},[e("h4",{class:"m-0"},"Promociones")],-1)),e("div",K,[e("p",Q,r(j.value),1),e("p",R,r(q.value),1)])]),e("div",W,[e("h5",Z,[o[17]||(o[17]=e("i",{class:"material-icons me-2"},"local_offer",-1)),y(" "+r(A.value),1)]),e("div",oo,[e("div",eo,[e("div",to,[e("button",{class:P(["btn",c.value==="activos"?"btn-primary":"btn-outline-primary"]),onClick:o[0]||(o[0]=t=>w("activos"))},"Activos",2),e("button",{class:P(["btn",c.value==="inactivos"?"btn-secondary":"btn-outline-secondary"]),onClick:o[1]||(o[1]=t=>w("inactivos"))},"Inactivos",2),e("button",{class:P(["btn",c.value==="todos"?"btn-info":"btn-outline-info"]),onClick:o[2]||(o[2]=t=>w("todos"))},"Todos",2)])]),e("div",so,[e("div",lo,[a(e("input",{type:"text",class:"form-control",placeholder:"Buscar promoción...","onUpdate:modelValue":o[3]||(o[3]=t=>f.value=t),onInput:M},null,544),[[k,f.value]]),e("button",{class:"btn btn-outline-secondary",onClick:o[4]||(o[4]=t=>{f.value=""})},o[18]||(o[18]=[e("i",{class:"material-icons"},"clear",-1)]))]),e("button",{class:"btn btn-success",onClick:B},o[19]||(o[19]=[e("i",{class:"material-icons me-1"},"add_box",-1)]))])])]),e("div",io,[e("div",ao,[e("div",no,[o[27]||(o[27]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"modalAgregarClienteLabel"},"Agregar nueva promoción"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Cerrar"})],-1)),e("div",ro,[e("div",co,[e("div",uo,[o[20]||(o[20]=e("label",{class:"form-label"},[e("b",null,"Nombre de la promoción")],-1)),a(e("input",{"onUpdate:modelValue":o[5]||(o[5]=t=>i.value.nombre=t),type:"text",class:"form-control",placeholder:"Ej. Mes del Amor"},null,512),[[k,i.value.nombre]])]),e("div",mo,[o[21]||(o[21]=e("label",{class:"form-label"},[e("b",null,"Descuento (%)")],-1)),a(e("input",{"onUpdate:modelValue":o[6]||(o[6]=t=>i.value.descuento=t),type:"number",class:"form-control",min:"1",max:"100",placeholder:"Ej. 20"},null,512),[[k,i.value.descuento,void 0,{number:!0}]])]),e("div",po,[o[25]||(o[25]=e("label",{class:"form-label"},[e("b",null,"Tipo de promoción")],-1)),e("div",vo,[a(e("input",{class:"form-check-input",type:"checkbox",id:"tipoProducto",value:"producto","onUpdate:modelValue":o[7]||(o[7]=t=>i.value.tipos=t)},null,512),[[v,i.value.tipos]]),o[22]||(o[22]=e("label",{class:"form-check-label",for:"tipoProducto"},"Producto",-1))]),e("div",bo,[a(e("input",{class:"form-check-input",type:"checkbox",id:"tipoServicio",value:"servicio","onUpdate:modelValue":o[8]||(o[8]=t=>i.value.tipos=t)},null,512),[[v,i.value.tipos]]),o[23]||(o[23]=e("label",{class:"form-check-label",for:"tipoServicio"},"Servicio",-1))]),e("div",fo,[a(e("input",{class:"form-check-input",type:"checkbox",id:"tipoPaquete",value:"paquete","onUpdate:modelValue":o[9]||(o[9]=t=>i.value.tipos=t)},null,512),[[v,i.value.tipos]]),o[24]||(o[24]=e("label",{class:"form-check-label",for:"tipoPaquete"},"Paquete",-1))])])])]),e("div",{class:"modal-footer"},[o[26]||(o[26]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancelar",-1)),e("button",{type:"button",class:"btn btn-success",onClick:U},"Agregar Promoción")])])])]),e("div",go,[o[32]||(o[32]=e("h5",{class:"mb-3 d-flex align-items-center"},[e("i",{class:"material-icons me-2"},"table_view"),y(" Listado de promociones ")],-1)),e("div",yo,[e("table",ko,[o[31]||(o[31]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Promoción"),e("th",null,"Descuento"),e("th",null,"Tipo"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(p(!0),m(O,null,J(T.value,t=>(p(),m("tr",{key:t.id},[e("td",null,r(t.id),1),e("td",null,r(t.nombre),1),e("td",null,r(t.descuento)+"%",1),e("td",null,r(t.tipo),1),e("td",ho,[e("div",wo,[e("button",{class:"btn btn-sm btn-outline-warning",title:"Editar",onClick:u=>D(t)},o[28]||(o[28]=[e("i",{class:"material-icons"},"edit",-1)]),8,Co),e("button",{class:"btn btn-sm btn-outline-danger",title:"Eliminar",onClick:u=>$(t.id)},o[29]||(o[29]=[e("i",{class:"material-icons"},"delete",-1)]),8,xo)])])]))),128)),T.value.length===0?(p(),m("tr",Po,o[30]||(o[30]=[e("td",{colspan:"5",class:"text-center text-muted"},"No hay promociones encontradas.",-1)]))):S("",!0)])])])]),l.value?(p(),m("div",To,[e("div",{class:"d-flex justify-content-between align-items-center mb-2"},[o[34]||(o[34]=e("h5",{class:"mb-0"},"Detalle de promoción",-1)),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:V,title:"Cerrar"},o[33]||(o[33]=[e("i",{class:"material-icons"},"close",-1)]))]),b.value?(p(),m("form",{key:0,onSubmit:G(_,["prevent"])},[e("div",jo,[e("div",qo,[o[35]||(o[35]=e("label",{class:"form-label"},[e("b",null,"Nombre de la promoción:")],-1)),a(e("input",{"onUpdate:modelValue":o[10]||(o[10]=t=>l.value.nombre=t),type:"text",class:"form-control"},null,512),[[k,l.value.nombre]])]),e("div",Eo,[o[36]||(o[36]=e("label",{class:"form-label"},[e("b",null,"Descuento (%):")],-1)),a(e("input",{"onUpdate:modelValue":o[11]||(o[11]=t=>l.value.descuento=t),type:"number",class:"form-control",min:"1",max:"100"},null,512),[[k,l.value.descuento,void 0,{number:!0}]])]),e("div",No,[o[40]||(o[40]=e("label",{class:"form-label"},[e("b",null,"Tipo de promoción")],-1)),e("div",So,[a(e("input",{class:"form-check-input",type:"checkbox",id:"editTipoProducto",value:"producto","onUpdate:modelValue":o[12]||(o[12]=t=>l.value.tipos=t)},null,512),[[v,l.value.tipos]]),o[37]||(o[37]=e("label",{class:"form-check-label",for:"editTipoProducto"},"Producto",-1))]),e("div",Do,[a(e("input",{class:"form-check-input",type:"checkbox",id:"editTipoServicio",value:"servicio","onUpdate:modelValue":o[13]||(o[13]=t=>l.value.tipos=t)},null,512),[[v,l.value.tipos]]),o[38]||(o[38]=e("label",{class:"form-check-label",for:"editTipoServicio"},"Servicio",-1))]),e("div",_o,[a(e("input",{class:"form-check-input",type:"checkbox",id:"editTipoPaquete",value:"paquete","onUpdate:modelValue":o[14]||(o[14]=t=>l.value.tipos=t)},null,512),[[v,l.value.tipos]]),o[39]||(o[39]=e("label",{class:"form-check-label",for:"editTipoPaquete"},"Paquete",-1))])])]),e("div",Vo,[o[41]||(o[41]=e("button",{type:"submit",class:"btn btn-success me-2"},"Guardar cambios",-1)),e("button",{type:"button",class:"btn btn-secondary",onClick:o[15]||(o[15]=t=>b.value=!1)},"Cancelar")])],32)):(p(),m("div",Bo,[e("div",Uo,[o[42]||(o[42]=e("b",null,"Nombre:",-1)),y(" "+r(l.value.nombre),1)]),e("div",Mo,[o[43]||(o[43]=e("b",null,"Descuento:",-1)),y(" "+r(l.value.descuento)+"%",1)]),e("div",$o,[o[44]||(o[44]=e("b",null,"Tipo:",-1)),y(" "+r(l.value.tipo),1)])]))])):S("",!0)])]))}},Lo=z(Ao,[["__scopeId","data-v-1f911204"]]);export{Lo as default};
